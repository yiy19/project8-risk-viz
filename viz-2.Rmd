---
title: "viz2"
author: "Ye Dam Yi"
date: "4/14/2021"
output: html_document
---
```{r libraries}
require(tidyverse)
require(haven)

```


```{r read-data}
risk_all <- read_spss("/Users/yedam/Documents/GitHub/DSP/Project/project7-emotion-risk/data/risk_excluded.sav")
risk_sur <- read_spss("/Users/yedam/Documents/GitHub/DSP/Project/project7-emotion-risk/data/risk_sur.sav")
risk_pred <- read_spss("/Users/yedam/Documents/GitHub/DSP/Project/project7-emotion-risk/data/risk_pred.sav")

write_sav(risk_all, "data/risk_all.sav")
write_sav(risk_sur, "data/risk_sur.sav")
write_sav(risk_pred, "data/risk_pred.sav")


risk_all <- risk_all %>% 
  mutate(gender = as_factor(gender),
         condition = as_factor(condition),
         rel_self = as_factor(rel_self),
         rel_friend1 = as_factor(rel_friend1),
         rel_friend2 = as_factor(rel_friend2)) 

```

```{r theme}

mytheme = theme(
  axis.title.x = element_text(size = 22),
  axis.text.x = element_text(size = 20),
  axis.title.y = element_text(size = 22),
  axis.ticks.length=unit(.25, "cm"),
  axis.text = element_text(size = 18)
)

```

```{r manipulation, fig.height=2, fig.width=3}
jpeg("manipulationcheck.jpg", width = 500, height = 380)

risk_all %>% 
  pivot_longer(c(riskyrisk, riskavrisk), names_to = "option", values_to = "riskrating") %>% 
  group_by(option) %>% 
  summarise(
    mean = mean(riskrating),
    sd = sd(riskrating)
  ) %>% 
  ggplot(aes(x = option, y = mean)) +
  
  geom_bar(stat = "identity", fill = "grey",position=position_dodge(), width = .5) +  
  geom_errorbar(aes(ymin= mean-sd, ymax = mean + sd),  width=.15, position=position_dodge(.9)) +
  labs(x = "",
       y = "Risk Levels") +
  scale_x_discrete(labels = c("Stay with Friends", "Approach Barista")) +
  scale_y_continuous(limits = c(-1, 4)) +
  theme_classic() +
  mytheme


dev.off()



```

```{r data-manipulation}
df <- risk_all %>% 
  group_by(condition) %>% 
  summarise(
    mean_risk = mean(risklevel),
    sd_risk = sd(risklevel),
    mean_neg = mean(neg),
    sd_neg = sd(neg),
    mean_pos = mean(pos),
    sd_pos = sd(pos),
    mean_alert = mean(alert),
    sd_alert = sd(alert)
  )
df
```
```{r risklevels}
jpeg("rt_bar.jpg", width = 500, height = 380)

df %>% 
  ggplot(aes(y = mean_risk, x = condition)) +
  geom_bar(stat = "identity", fill = "grey",position=position_dodge(), width = .5) +
  geom_errorbar(aes(ymin = mean_risk - sd_risk, ymax = mean_risk + sd_risk),  width=.15, position=position_dodge(.9)) +
  labs(x = "",
       y = "Risk Taking Levels") +
  scale_x_discrete(labels = c("Self", "Surrogate", "Prediction")) +
  scale_y_continuous(limits = c(0,6), breaks = c(0,1,2,3,4,5,6)) +
  theme_classic() +
  mytheme

dev.off()

```

```{r neg}
jpeg("neg_bar.jpg", width = 500, height = 380)

df %>% 
  ggplot(aes(y = mean_neg, x = condition)) +
  geom_bar(stat = "identity", fill = "grey",position=position_dodge(), width = .5) +
  geom_errorbar(aes(ymin = mean_neg - sd_neg, ymax = mean_neg + sd_neg),  width=.15, position=position_dodge(.9)) +
  labs(x = "",
       y = "Negative Emotion") +
  scale_x_discrete(labels = c("Self", "Surrogate", "Prediction")) +
  scale_y_continuous(limits = c(0,4)) +
  theme_classic() +
  mytheme

dev.off()

```

```{r pos}
jpeg("pos_bar.jpg", width = 500, height = 380)

df %>% 
  ggplot(aes(y = mean_pos, x = condition)) +
  geom_bar(stat = "identity", fill = "grey",position=position_dodge(), width = .5) +
  geom_errorbar(aes(ymin = mean_pos - sd_pos, ymax = mean_pos + sd_pos), width=.15, position=position_dodge(.9)) +
  labs(x = "",
       y = "Positive Emotion") +
  scale_x_discrete(labels = c("Self", "Surrogate", "Prediction")) +
  theme_classic() +
  mytheme

dev.off()

```

```{r alert}
jpeg("alert_bar.jpg", width = 500, height = 380)

df %>% 
  ggplot(aes(y = mean_alert, x = condition)) +
  geom_bar(stat = "identity", fill = "grey", position=position_dodge(), width = .5) +
  geom_errorbar(aes(ymin = mean_alert - sd_alert, ymax = mean_alert + sd_alert), width=.15, position=position_dodge(.9)) +
  labs(x = "",
       y = "Alertness") +
  scale_x_discrete(labels = c("Self", "Surrogate", "Prediction")) +
  theme_classic() +
  mytheme

dev.off()

```